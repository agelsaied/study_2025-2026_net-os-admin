---
## Front matter
title: "Отчёт по лабораторной работе 2"
subtitle: "Настройка DNS-сервера"
author: "Элсаиед Адел"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию DNSсервера, усвоение принципов работы системы доменных имён.

# Выполнение

## Установка и конфигурирование кэширующего DNS-сервера (BIND)

1. После загрузки операционной системы выполнен переход в рабочий каталог проекта с виртуальными машинами. Далее была запущена виртуальная машина **server**. После завершения загрузки системы выполнен вход под ранее созданным пользователем и осуществлён переход в режим суперпользователя.

2. На виртуальной машине server произведена установка пакетов bind и bind-utils с использованием менеджера пакетов DNF. В процессе установки система автоматически разрешила зависимости и успешно установила необходимые компоненты DNS-сервера BIND и вспомогательные утилиты.

   ![Установка пакетов bind и bind-utils](Screenshot_1.png){ #fig:001 width=80% }

3. В качестве проверки работоспособности DNS-разрешения имён выполнен запрос к доменному имени www.yandex.ru с использованием утилиты dig. В результате был получен корректный DNS-ответ со статусом NOERROR, содержащий несколько A-записей с IP-адресами серверов Яндекса.

   В выводе команды:
   - строка HEADER указывает на успешную обработку DNS-запроса;
   - opcode QUERY означает стандартный запрос на разрешение имени;
   - статус NOERROR свидетельствует об отсутствии ошибок;
   - флаги rd и ra показывают, что была запрошена и выполнена рекурсия;
   - секция QUESTION SECTION содержит исходный DNS-запрос;
   - секция ANSWER SECTION содержит IP-адреса, соответствующие доменному имени;
   - строка SERVER указывает DNS-сервер, использованный для обработки запроса;
   - параметр Query time отражает время выполнения запроса.

   ![DNS-запрос dig www.yandex.ru](Screenshot_2.png){ #fig:002 width=80% }

4. Выполнен анализ файла /etc/resolv.conf. Данный файл автоматически сгенерирован NetworkManager и содержит домен поиска elsaiedadel.net, а также IP-адрес DNS-сервера, используемого системой по умолчанию.

   Также проанализирован файл /etc/named.conf, содержащий основную конфигурацию DNS-сервера BIND. В конфигурации определены параметры прослушивания порта 53 на локальном интерфейсе, рабочий каталог сервера, файлы статистики и ограничения на обработку DNS-запросов только от localhost.

   ![Файлы resolv.conf и named.conf](Screenshot_3.png){ #fig:003 width=80% }

5. Проанализирован файл /var/named/named.ca, содержащий информацию о корневых DNS-серверах Интернета. Данный файл используется для начальной инициализации кэша DNS-сервера и включает список корневых серверов зоны, их имена и IPv4/IPv6-адреса.

   ![Файл named.ca](Screenshot_4.png){ #fig:004 width=80% }

6. Проанализированы файлы /var/named/named.localhost и /var/named/named.loopback. В них описана локальная зона localhost, определены записи SOA, NS, а также A и AAAA-записи для адресов 127.0.0.1 и ::1, обеспечивающие корректную работу локального DNS-разрешения.

   ![Файлы named.localhost и named.loopback](Screenshot_5.png){ #fig:005 width=80% }

7. Выполнен DNS-запрос с явным указанием локального DNS-сервера по адресу 127.0.0.1. В результате получен ответ со статусом SERVFAIL, что указывает на отсутствие корректной обработки рекурсивных запросов локальным DNS-сервером на данном этапе.

   Отличие данного запроса от запроса без указания сервера заключается в том, что в этом случае запрос обрабатывается непосредственно локальным DNS-сервером, а не внешним DNS-сервером, полученным по DHCP.

   ![DNS-запрос через локальный сервер](Screenshot_6.png){ #fig:006 width=80% }

8. Для назначения DNS-сервера server сервером по умолчанию выполнена настройка сетевого соединения eth0 с использованием NetworkManager. Были удалены автоматически полученные DNS-адреса, отключено их автоматическое применение и явно задан DNS-сервер 127.0.0.1. После перезапуска NetworkManager изменения были подтверждены в файле /etc/resolv.conf.

   ![Настройка DNS через NetworkManager](Screenshot_7.png){ #fig:007 width=80% }

9. Для обеспечения обработки DNS-запросов от всех узлов внутренней сети выполнено редактирование файла /etc/named.conf. Параметр прослушивания был изменён для работы на всех сетевых интерфейсах, а директива allow-query дополнена разрешением запросов от подсети 192.168.0.0/16.

   ![Изменение конфигурации named.conf](Screenshot_8.png){ #fig:008 width=80% }

10. В настройках межсетевого экрана сервера разрешена служба DNS. Изменения применены как для текущей сессии, так и на постоянной основе.

11. Для подтверждения корректной работы DNS-сервера выполнена проверка прослушивания UDP-порта 53. В выводе команды зафиксировано, что процесс named активно использует порт 53, что подтверждает прохождение DNS-запросов через узел server и корректную работу кэширующего DNS-сервера.

   ![Проверка работы DNS-сервера через lsof](Screenshot_9.png){ #fig:009 width=80% }

# Выполнение

## Конфигурирование первичного DNS-сервера

1. Для конфигурирования первичного DNS-сервера выполнено копирование шаблона описания DNS-зон named.rfc1912.zones из каталога /etc в каталог /etc/named с последующим переименованием файла в elsaiedadel.net. Данный файл предназначен для описания прямой и обратной DNS-зон пользователя.

2. Файл описания зон elsaiedadel.net был подключён в основной конфигурационный файл DNS-сервера /etc/named.conf путём добавления директивы include в конце файла. Это позволило DNS-серверу учитывать пользовательские зоны при запуске.

   ![Подключение файла зон в named.conf](Screenshot_10.png){ #fig:010 width=80% }

3. В файле /etc/named/elsaiedadel.net выполнено редактирование шаблонных зон. Вместо стандартной зоны localhost.localdomain была описана прямая зона elsaiedadel.net с типом master и указанием файла зоны master/fz/elsaiedadel.net.  
   Аналогично вместо зоны обратной петли 127.0.0.1 была определена обратная зона 1.168.192.in-addr.arpa с файлом зоны master/rz/192.168.1. Все прочие записи из файла были удалены.

   ![Описание прямой и обратной зон](Screenshot_11.png){ #fig:011 width=80% }

4. В каталоге /var/named были созданы подкаталоги master/fz и master/rz, предназначенные для хранения файлов прямой и обратной DNS-зон соответственно. Данная структура соответствует рекомендуемой иерархии BIND для мастер-зон.

5. Шаблон файла прямой зоны named.localhost был скопирован в каталог /var/named/master/fz и переименован в elsaiedadel.net. После этого файл был отредактирован с учётом параметров пользовательского домена.

6. В файле /var/named/master/fz/elsaiedadel.net были внесены следующие изменения:
   - DNS-имя сервера в записи SOA изменено на server.elsaiedadel.net;
   - серийный номер зоны задан в формате ГГГГММДДВВ;
   - A-запись изменена с адреса 127.0.0.1 на 192.168.1.1;
   - директива $ORIGIN установлена в значение elsaiedadel.net.;
   - добавлены A-записи для узлов server и ns с адресом 192.168.1.1.

   ![Файл прямой зоны elsaiedadel.net](Screenshot_12.png){ #fig:012 width=80% }

7. Шаблон файла обратной зоны named.loopback был скопирован в каталог /var/named/master/rz и переименован в 192.168.1. Далее файл был отредактирован для описания обратного разрешения адресов.

8. В файле /var/named/master/rz/192.168.1 были выполнены следующие изменения:
   - DNS-имя сервера в записи SOA изменено на server.elsaiedadel.net;
   - серийный номер зоны приведён к требуемому формату;
   - адрес в A-записи изменён на 192.168.1.1;
   - директива $ORIGIN установлена в значение 1.168.192.in-addr.arpa.;
   - добавлены PTR-записи, сопоставляющие IP-адрес 192.168.1.1 с именами server.elsaiedadel.net и ns.elsaiedadel.net.

   ![Файл обратной зоны 192.168.1](Screenshot_13.png){ #fig:013 width=80% }

9. Для обеспечения корректного доступа DNS-сервера к конфигурационным файлам и файлам зон были изменены права собственности каталогов /etc/named и /var/named. Владельцем файлов назначен пользователь и группа named.

10. После изменения конфигурационных файлов выполнено восстановление контекстов безопасности SELinux для каталогов /etc и /var/named. Также проверено состояние SELinux-переключателей, относящихся к службе named. Демону named было разрешено выполнять запись в файлы мастер-зон.

   ![Настройка SELinux для named](Screenshot_14.png){ #fig:014 width=80% }

11. Для контроля корректности работы DNS-сервера в дополнительном терминале был запущен просмотр системного журнала в режиме реального времени. После этого DNS-сервер был перезапущен. В журнале системных сообщений ошибок не зафиксировано, что свидетельствует о корректной конфигурации первичного DNS-сервера.

## Анализ работы DNS-сервера

1. Для проверки корректности работы первичного DNS-сервера выполнен запрос к DNS-имени ns.elsaiedadel.net с использованием утилиты dig. В ответе сервера получен статус NOERROR, что свидетельствует об успешной обработке запроса.  

   В секции ANSWER SECTION присутствует A-запись, сопоставляющая имя ns.elsaiedadel.net с IP-адресом 192.168.1.1.  
   Флаг aa указывает, что ответ является авторитативным, а строка SERVER подтверждает, что запрос был обработан локальным DNS-сервером по адресу 127.0.0.1.

   ![Проверка A-записи ns.elsaiedadel.net](Screenshot_15.png){ #fig:015 width=80% }

2. Для дополнительной проверки корректности конфигурации DNS-сервера выполнен анализ с использованием утилиты host.  

   Команда host -l elsaiedadel.net вывела список DNS-записей зоны, подтвердив наличие сервера имён, а также корректное сопоставление доменных имён server.elsaiedadel.net и ns.elsaiedadel.net с IP-адресом 192.168.1.1.  

   Команда host -a elsaiedadel.net вернула подробное описание зоны, включая записи SOA, NS и A, что подтверждает корректную настройку прямой зоны.  

   Команда host -t A elsaiedadel.net подтвердила наличие A-записи для домена elsaiedadel.net.  

   Команда host -t PTR 192.168.1.1 успешно разрешила IP-адрес в доменные имена server.elsaiedadel.net и ns.elsaiedadel.net, что свидетельствует о корректной настройке обратной DNS-зоны.

   ![Проверка DNS-зоны утилитой host](Screenshot_16.png){ #fig:016 width=80% }

## Внесение изменений в настройки внутреннего окружения виртуальной машины

3. Для подготовки автоматической инициализации DNS-сервера при запуске виртуальной машины выполнен переход в каталог /vagrant. В нём была создана иерархия каталогов provision/server/dns, предназначенная для хранения конфигурационных файлов DNS-сервера.

   В соответствующие подкаталоги были скопированы файлы конфигурации из каталогов /etc/named и /var/named/master, используемые ранее при ручной настройке DNS-сервера.

   ![Подготовка каталогов и копирование конфигурации](Screenshot_17.png){ #fig:017 width=80% }

4. В каталоге /vagrant/provision/server был создан исполняемый файл dns.sh, предназначенный для автоматической установки и настройки DNS-сервера. В скрипт были включены действия по установке пакетов bind и bind-utils, копированию конфигурационных файлов, настройке прав доступа, восстановлению контекстов безопасности SELinux, настройке межсетевого экрана, конфигурированию DNS-сервера по умолчанию для сетевого интерфейса, а также запуску и включению службы named в автозагрузку.

   Данный скрипт полностью воспроизводит ранее выполненные действия по ручной установке и настройке DNS-сервера.

   ![Скрипт автоматической настройки DNS-сервера](Screenshot_18.png){ #fig:018 width=80% }

5. Для обеспечения автоматического выполнения созданного скрипта при запуске виртуальной машины server в конфигурационный файл Vagrantfile был добавлен provisioning-блок shell. Это позволяет при каждом запуске виртуальной машины автоматически разворачивать и настраивать DNS-сервер без необходимости ручного вмешательства.

   В результате выполненных действий DNS-сервер корректно функционирует как первичный и кэширующий сервер, обслуживает прямую и обратную зоны, а также автоматически настраивается при развёртывании виртуальной машины.

# Вывод

В ходе выполнения лабораторной работы был установлен, настроен и протестирован DNS-сервер на базе BIND. Реализована работа кэширующего и первичного DNS-сервера, выполнена настройка прямой и обратной DNS-зон, обеспечена корректная обработка DNS-запросов от локального узла и внутренней виртуальной сети. Проведена проверка работы сервера с использованием утилит dig и host, подтверждена корректность разрешения имён и обратного разрешения IP-адресов. Дополнительно выполнена автоматизация настройки DNS-сервера с использованием provisioning-скрипта, что обеспечивает воспроизводимость и удобство развёртывания сервиса. В результате DNS-сервер функционирует стабильно и соответствует требованиям задания.

# Контрольные вопросы

**1. Что такое DNS?**  
DNS (Domain Name System) — это распределённая иерархическая система доменных имён, предназначенная для преобразования символьных доменных имён в IP-адреса и обратно, а также для хранения и предоставления различной служебной информации о сетевых ресурсах.

**2. Каково назначение кэширующего DNS-сервера?**  
Кэширующий DNS-сервер принимает запросы от клиентов, при необходимости запрашивает информацию у других DNS-серверов и сохраняет полученные ответы в кэше. Это позволяет ускорить последующие запросы и снизить нагрузку на внешние DNS-серверы.

**3. Чем отличается прямая DNS-зона от обратной?**  
Прямая DNS-зона предназначена для сопоставления доменных имён IP-адресам.  
Обратная DNS-зона используется для сопоставления IP-адресов доменным именам и применяется, например, при проверке подлинности узлов.

**4. В каких каталогах и файлах располагаются настройки DNS-сервера? Кратко охарактеризуйте их назначение.**  
Основные настройки располагаются в файле `/etc/named.conf`, который содержит общую конфигурацию сервера и подключение зон.  
Файлы зон обычно хранятся в каталоге `/var/named` и его подкаталогах.  
Файл `/etc/resolv.conf` содержит настройки DNS-клиента.

**5. Что указывается в файле resolv.conf?**  
В файле `/etc/resolv.conf` указываются адреса DNS-серверов, используемых системой, а также домен поиска, применяемый при разрешении имён.

**6. Какие типы записей описания ресурсов есть в DNS и для чего они используются?**  
A — сопоставляет имя IPv4-адресу.  
AAAA — сопоставляет имя IPv6-адресу.  
NS — указывает серверы имён зоны.  
SOA — содержит служебную информацию о зоне.  
PTR — используется для обратного разрешения IP-адресов.  
MX — указывает почтовые серверы домена.  
CNAME — создаёт псевдоним доменного имени.

**7. Для чего используется домен in-addr.arpa?**  
Домен in-addr.arpa используется для организации обратного DNS-разрешения IPv4-адресов, то есть преобразования IP-адреса в доменное имя.

**8. Для чего нужен демон named?**  
Демон named является основной службой DNS-сервера BIND. Он обрабатывает DNS-запросы, управляет зонами, кэшем и взаимодействует с другими DNS-серверами.

**9. В чём заключаются основные функции slave-сервера и master-сервера?**  
Master-сервер является основным источником данных DNS-зоны и хранит её оригинальные файлы.  
Slave-сервер получает копию зоны с master-сервера и используется для повышения отказоустойчивости и распределения нагрузки.

**10. Какие параметры отвечают за время обновления зоны?**  
За время обновления зоны отвечают параметры записи SOA: refresh, retry, expire и minimum.

**11. Как обеспечить защиту зоны от скачивания и просмотра?**  
Защита обеспечивается настройкой директив allow-transfer и allow-query, а также ограничением доступа по IP-адресам и использованием межсетевого экрана.

**12. Какая запись RR применяется при создании почтовых серверов?**  
Для описания почтовых серверов используется запись типа MX (Mail Exchange).

**13. Как протестировать работу сервера доменных имён?**  
Работу DNS-сервера можно протестировать с помощью утилит dig, host и nslookup, выполнив запросы к различным типам DNS-записей.

**14. Как запустить, перезапустить или остановить какую-либо службу в системе?**  
Для управления службами используется systemd. Запуск, перезапуск и остановка служб выполняются с помощью соответствующих команд управления сервисами.

**15. Как посмотреть отладочную информацию при запуске какого-либо сервиса или службы?**  
Отладочную информацию можно просмотреть через системный журнал, а также запустив сервис с повышенным уровнем логирования.

**16. Где хранится отладочная информация по работе системы и служб? Как её посмотреть?**  
Отладочная информация хранится в системном журнале. Для её просмотра используется журнал системных сообщений.

**17. Как посмотреть, какие файлы использует в своей работе тот или иной процесс? Приведите примеры.**  
Для этого можно использовать утилиты lsof или fuser, которые отображают файлы и порты, используемые процессами.

**18. Приведите несколько примеров по изменению сетевого соединения при помощи nmcli.**  
С помощью nmcli можно изменять DNS-серверы, включать или отключать автоматическое получение параметров, изменять IP-адреса и перезапускать сетевые соединения.

**19. Что такое SELinux?**  
SELinux — это подсистема безопасности Linux, реализующая механизм мандатного управления доступом на основе политик безопасности.

**20. Что такое контекст (метка) SELinux?**  
Контекст SELinux — это метка безопасности, присваиваемая процессам и файлам, определяющая допустимые операции доступа.

**21. Как восстановить контекст SELinux после внесения изменений в конфигурационные файлы?**  
Контекст SELinux восстанавливается с помощью утилиты restorecon, которая назначает файлам корректные метки безопасности.

**22. Как создать разрешающие правила политики SELinux из файлов журналов?**  
Для создания разрешающих правил используются утилиты анализа журналов SELinux, которые формируют модули политики на основе сообщений о запретах.

**23. Что такое булевый переключатель в SELinux?**  
Булевый переключатель SELinux — это параметр, позволяющий динамически изменять поведение политики безопасности без её полной переработки.

**24. Как посмотреть список переключателей SELinux и их состояние?**  
Список булевых переключателей и их текущее состояние можно просмотреть с помощью специальной утилиты управления SELinux.

**25. Как изменить значение переключателя SELinux?**  
Значение булевого переключателя изменяется с помощью команды управления SELinux, с возможностью применения изменений временно или на постоянной основе.
