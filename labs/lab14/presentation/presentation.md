---
lang: ru-RU
title: Настройка файловых служб Samba
subtitle: Лабораторная работа №14
author:
  - Элсаиед Адел
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 7 января 2026

toc: false
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Цели и задачи работы

## Цель лабораторной работы

Приобретение навыков настройки доступа групп пользователей к общим ресурсам по протоколу SMB, а также монтирования Samba-ресурса на клиенте и автоматизации конфигурации через provisioning.

# Выполнение работы

## Настройка Samba-сервера: конфигурация smb.conf

На сервере настроена рабочая группа и создан ресурс **sambashare**, публикующий каталог `/srv/sambashare`.  
Запись разрешена пользователям группы `sambagroup`.

![Конфигурация smb.conf и ресурс sambashare](Screenshot_1.png){ #fig:001 width=70% }

## Проверка публикации ресурса

Проверка доступных ресурсов выполнена утилитой `smbclient`.  
Подтверждена доступность общего ресурса `sambashare`.

![Проверка ресурсов через smbclient](Screenshot_2.png){ #fig:003 width=70% }

## Firewalld на сервере: сервис Samba

Изучен профиль firewalld для Samba и определены порты, необходимые для работы SMB (TCP 139/445).

![Профиль firewalld для Samba](Screenshot_3.png){ #fig:004 width=70% }

## Доступ и SELinux на сервере

Выполнено:
- разрешение сервиса Samba в firewalld;
- настройка прав на каталог `/srv/sambashare` на уровне группы;
- назначение SELinux-контекста `samba_share_t`;
- включение boolean для экспорта ресурса на чтение/запись.

![Права, SELinux-контекст и настройки сервера](Screenshot_4.png){ #fig:005 width=70% }

## Проверка записи на сервере

Под пользователем выполнено создание тестового файла в `/srv/sambashare`.  
Подтверждено корректное наследование владельца и группы.

![Создание тестового файла на сервере](Screenshot_5.png){ #fig:006 width=70% }

## Клиент: firewalld и подготовка окружения

На клиенте:
- изучен профиль firewalld для `samba-client`;
- разрешён сервис `samba-client`;
- подготовлена группа `sambagroup` и добавлен пользователь.

![Профиль firewalld samba-client](Screenshot_6.png){ #fig:007 width=70% }

## Клиент: настройка firewalld

Сервис `samba-client` разрешён во временной и постоянной конфигурации.  
Выполнена перезагрузка правил firewalld.

![Настройка firewalld на клиенте](Screenshot_7.png){ #fig:008 width=70% }

## Клиент: настройка рабочей группы

В `/etc/samba/smb.conf` на клиенте задана рабочая группа, соответствующая серверу.

![Рабочая группа в smb.conf на клиенте](Screenshot_8.png){ #fig:009 width=70% }

## Клиент: просмотр ресурсов (анонимно и по пользователю)

Проверен список ресурсов сервера:
- в анонимном режиме;
- под учётной записью пользователя (аутентифицировано).

![Просмотр ресурсов сервера с клиента](Screenshot_9.png){ #fig:010 width=70% }

## Клиент: ручное монтирование ресурса

Ресурс `//server/sambashare` смонтирован в `/mnt/samba`.  
Тип монтирования — `cifs`, параметры подключения применены корректно.

![Ручное монтирование Samba-ресурса](Screenshot_10.png){ #fig:011 width=70% }

## Клиент: проверка записи на смонтированном ресурсе

В каталоге `/mnt/samba` создан тестовый файл.  
Подтверждена возможность записи пользователем на сетевой ресурс.

![Проверка записи на ресурсе](Screenshot_11.png){ #fig:012 width=70% }

## Клиент: файл учётных данных

Для исключения хранения пароля в явном виде подготовлен файл `/etc/samba/smbusers` с ограниченными правами доступа.

![Файл smbusers](Screenshot_12.png){ #fig:013 width=70% }

## Клиент: автомонтирование через /etc/fstab

В `/etc/fstab` добавлена строка для монтирования CIFS с использованием:
- `credentials=/etc/samba/smbusers`;
- `uid` и `gid` для согласования прав;
- `_netdev` для монтирования после инициализации сети.

![Запись в /etc/fstab](Screenshot_13.png){ #fig:014 width=70% }

## Клиент: проверка mount -a

Выполнено монтирование всех файловых систем из `/etc/fstab`.  
Подтверждено, что Samba-ресурс монтируется корректно.

![Результат mount -a и список монтирований](Screenshot_14.png){ #fig:015 width=70% }

## Server: подготовка provisioning-окружения

На сервере подготовлена структура `/vagrant/provision/server/smb/...` и сохранён эталонный `smb.conf` для последующего развёртывания через скрипт.

![Подготовка provisioning на server](Screenshot_15.png){ #fig:016 width=70% }

## Server: provisioning-скрипт smb.sh

![Скрипт smb.sh для server](Screenshot_16.png){ #fig:017 width=70% }

## Client: подготовка provisioning-окружения

На клиенте подготовлена структура `/vagrant/provision/client/smb/...` и сохранены файлы `smb.conf` и `smbusers`.

![Подготовка provisioning на client](Screenshot_17.png){ #fig:018 width=70% }

## Client: provisioning-скрипт smb.sh

![Скрипт smb.sh для client](Screenshot_18.png){ #fig:019 width=70% }

# Выводы

## Вывод

Выполнена настройка Samba-сервера и клиента: опубликован общий ресурс, настроены права доступа, firewalld и SELinux, выполнено ручное и автоматическое монтирование на клиенте. Реализована автоматизация конфигурации через provisioning-скрипты, обеспечивающая воспроизводимое развёртывание стенда и корректный доступ пользователей к разделяемым данным.
