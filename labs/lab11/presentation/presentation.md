---
lang: ru-RU
title: Настройка безопасного удалённого доступа по SSH
subtitle: Лабораторная работа №11
author:
  - Элсаиед Адел
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 6 января 2026

toc: false
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Цели и задачи работы

## Цель лабораторной работы

Приобретение практических навыков по настройке безопасного удалённого доступа к серверу с помощью протокола SSH.

# Выполнение работы

## Запрет доступа по SSH для пользователя root

На сервере выполнен запрет удалённого входа для root с помощью параметра `PermitRootLogin no`. Повторная попытка входа фиксируется в журналах и завершается отказом на стадии аутентификации.

![Запрет входа root через PermitRootLogin no](Screenshot_2.png){ #fig:001 width=70% }

## Контроль попыток входа root в журнале

При попытке SSH-входа под root на сервере регистрируются события отказа/завершения сессии, что подтверждает применение настроек безопасности.

![Попытка входа root после запрета](Screenshot_1.png){ #fig:002 width=70% }

## Ограничение списка пользователей (AllowUsers)

Для контроля удалённого доступа задан список разрешённых пользователей. При включении `AllowUsers vagrant` подключения прочих пользователей отклоняются.

![Ограничение доступа по SSH параметром AllowUsers](Screenshot_5.png){ #fig:003 width=70% }

## Восстановление доступа добавлением пользователя в AllowUsers

Для разрешения подключения добавлен пользователь `elsaiedadel` в список. После перезапуска sshd удалённый вход становится доступен.

![Добавление пользователя в AllowUsers](Screenshot_7.png){ #fig:004 width=70% }

## Перенос SSH на порт 2022: корректная конфигурация

Для работы SSH на порту 2022 в конфигурации заданы отдельные директивы `Port 22` и `Port 2022`, что обеспечивает одновременное прослушивание двух портов.

![Настройка Port 22 и Port 2022 в sshd_config](Screenshot_13.png){ #fig:005 width=70% }

## SELinux и firewall для порта 2022

Выполнена настройка SELinux для разрешения контекста `ssh_port_t` на 2022 и открытие `2022/tcp` в межсетевом экране. После исправления конфигурации sshd успешно запущен и слушает порт 2022.

![Настройка SELinux и firewalld и успешный запуск sshd](Screenshot_11.png){ #fig:006 width=70% }

## Проверка подключений по портам 22 и 2022

С клиента подтверждено, что соединение устанавливается как по порту 22 (по умолчанию), так и по порту 2022 при явном указании параметров подключения.

![Проверка SSH-подключения на портах 22 и 2022](Screenshot_12.png){ #fig:007 width=70% }

## Аутентификация по ключу (PubkeyAuthentication)

На сервере включена аутентификация по ключу. На клиенте создана пара ключей и открытый ключ установлен на сервер, после чего вход выполняется без запроса пароля.

![Копирование ключа на сервер и вход без пароля](Screenshot_14.png){ #fig:008 width=70% }

## SSH-туннель: перенаправление порта 8080 на 80

Организовано перенаправление: локальный порт 8080 обслуживается процессом SSH и проксирует доступ к удалённому сервису на порту 80. Состояние подтверждается появлением локального LISTEN и активного SSH-соединения.

![TCP-сокеты до/после создания туннеля](Screenshot_15.png){ #fig:009 width=70% }

## Проверка туннеля в браузере

При открытии `localhost:8080` на клиенте отображается приветственная страница, что подтверждает корректную работу туннеля и перенаправления.

![Страница Welcome через localhost:8080](Screenshot_16.png){ #fig:010 width=70% }

## Запуск удалённых консольных команд через SSH

Проверен запуск команд на сервере без интерактивной сессии: получение имени хоста, просмотр файлов и проверка почты. Это демонстрирует применение SSH как инструмента удалённого администрирования.

![Удалённый запуск hostname, ls и mail](Screenshot_17.png){ #fig:011 width=70% }

## X11 Forwarding: попытка запуска графического приложения

Разрешено `X11Forwarding yes`, затем выполнена попытка удалённого запуска Firefox. На клиенте получена ошибка, связанная с отсутствием DISPLAY и невозможностью X11-перенаправления, что указывает на необходимость настроенного X-сервера на стороне клиента.

![Ошибка X11: отсутствует DISPLAY](Screenshot_19.png){ #fig:012 width=70% }

## Автоматизация настроек: provisioning-скрипт ssh.sh

Подготовлен скрипт, который копирует эталонную конфигурацию SSH, восстанавливает контексты SELinux, настраивает firewall для 2022 и перезапускает sshd. Это обеспечивает воспроизводимое применение настроек при запуске ВМ.

![Provisioning-скрипт ssh.sh](Screenshot_21.png){ #fig:013 width=70% }

# Выводы

## Вывод

В ходе работы выполнена настройка безопасного SSH-доступа: запрещён вход root, ограничены пользователи, настроены ключи, выполнен перенос SSH на порт 2022 с поддержкой SELinux и firewall, проверены туннели и удалённый запуск команд. Подготовлен provisioning-скрипт для автоматизации конфигурации SSH в среде виртуализации.
