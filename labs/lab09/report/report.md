---
## Front matter
title: "Отчёт по лабораторной работе 9"
subtitle: "Настройка POP3/IMAP сервера"
author: "Элсаиед Адел"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и простейшему конфигурированию POP3/IMAP-сервера.

# Выполнение

## Установка и настройка почтового сервера Dovecot

1. На виртуальной машине **Server** выполнен вход под пользовательской учётной записью с последующим переходом в режим суперпользователя. После получения прав администратора произведена установка необходимых пакетов для работы почтового сервера Dovecot и тестирования почтовых протоколов.

2. В конфигурационном файле `/etc/dovecot/dovecot.conf` произведена настройка списка почтовых протоколов, поддерживаемых сервером Dovecot. Для обеспечения приёма почты по протоколам IMAP и POP3 был задан параметр `protocols = imap pop3`.

   ![Настройка поддерживаемых протоколов Dovecot](Screenshot_1.png){ #fig:006 width=80% }

3. В конфигурационном файле `/etc/dovecot/conf.d/10-auth.conf` проверен и задан механизм аутентификации пользователей. В качестве метода аутентификации выбран `plain`, что соответствует стандартной схеме работы с системной базой пользователей.

   ![Настройка механизма аутентификации](Screenshot_2.png){ #fig:007 width=80% }

4. В файле `/etc/dovecot/conf.d/auth-system.conf.ext` выполнена проверка параметров поиска пользователей и их учётных данных. Для аутентификации используется модуль PAM, а для получения информации о пользователях — системный файл `/etc/passwd`.

   ![Настройка источников аутентификации пользователей](Screenshot_3.png){ #fig:008 width=80% }

5. В конфигурационном файле `/etc/dovecot/conf.d/10-mail.conf` настроено месторасположение почтовых ящиков пользователей. В качестве формата хранения почты выбран `Maildir`, размещаемый в домашнем каталоге пользователя.

   ![Настройка расположения почтовых ящиков](Screenshot_4.png){ #fig:009 width=80% }

6. Для корректной доставки почты сервером Postfix выполнена настройка каталога доставки входящих сообщений с использованием формата `Maildir`.

7. С целью обеспечения сетевого доступа к почтовым службам выполнена настройка межсетевого экрана. Разрешена работа сервисов протоколов POP3, POP3S, IMAP и IMAPS, после чего выполнена перезагрузка правил и проверка активных служб.

   ![Настройка межсетевого экрана для почтовых протоколов](Screenshot_5.png){ #fig:010 width=80% }

8. Для восстановления корректных контекстов безопасности SELinux выполнено восстановление контекста для каталога `/etc`.

9. Завершающим этапом выполнен перезапуск почтового сервера Postfix, а также включение и запуск службы Dovecot. Сервис успешно добавлен в автозагрузку и запущен без ошибок.

## Проверка работы почтового сервера Dovecot

1. На виртуальной машине **Server** был открыт дополнительный терминал, в котором запущен мониторинг работы почтовых служб. В процессе тестирования отслеживались сообщения о подключениях клиентов, приёме и доставке почты, а также состоянии очереди сообщений.

   ![Мониторинг почтовой службы Postfix и Dovecot](Screenshot_6.png){ #fig:011 width=80% }

2. Для просмотра почтовых сообщений, доставленных локальному пользователю, выполнен просмотр содержимого почтового ящика в формате Maildir. В результате отображены два тестовых сообщения со статусом «непрочитано», что подтверждает корректную доставку писем в каталог пользователя.

   ![Просмотр почты в Maildir на сервере](Screenshot_7.png){ #fig:012 width=80% }

3. Попытка просмотра списка mailbox пользователя с использованием утилиты `doveadm` без прав суперпользователя завершилась ошибкой доступа к сокету статистики Dovecot. Это поведение является ожидаемым и подтверждает корректную работу механизма разграничения прав доступа.

   ![Проверка mailbox с помощью doveadm](Screenshot_8.png){ #fig:013 width=80% }

4. На виртуальной машине **Client** выполнен вход под пользовательской учётной записью и установка почтового клиента Evolution. После запуска приложения выполнена настройка новой почтовой учётной записи.

   ![Окно сводки учётной записи Evolution](Screenshot_9.png){ #fig:014 width=80% }

5. В процессе настройки почтового клиента указаны параметры подключения к почтовому серверу:  
   – входящий сервер IMAPX с адресом `mail.elsiaedadel.net`;  
   – исходящий сервер SMTP с тем же адресом;  
   – имя пользователя соответствует системному логину;  
   – для IMAP использован порт 143 с шифрованием STARTTLS;  
   – для SMTP использован порт 25 без аутентификации.  

   Настройки успешно сохранены, подключение к серверу установлено.

6. Из почтового клиента Evolution отправлены тестовые сообщения самому себе. Все письма были успешно доставлены и отображены в папке «Входящие», что подтверждает корректную работу связки Postfix и Dovecot по протоколу IMAP.

   ![Получение тестовых писем в Evolution](Screenshot_10.png){ #fig:015 width=80% }

7. Параллельно выполнена проверка почтового сервера с использованием протокола POP3 через Telnet. После успешной аутентификации пользователя получен список писем в почтовом ящике, выполнено чтение первого письма и удаление второго письма, после чего сеанс корректно завершён.

   ![Проверка POP3 через Telnet](Screenshot_11.png){ #fig:016 width=80% }

8. Для подтверждения автоматизации конфигурации почтового сервера выполнено копирование конфигурационных файлов Dovecot в каталог `/vagrant/provision/server/mail/` с целью последующего использования при provisioning виртуальной машины.

   ![Копирование конфигурационных файлов Dovecot](Screenshot_12.png){ #fig:017 width=80% }

9. В файл автоматической настройки `/vagrant/provision/server/mail.sh` добавлены действия по установке пакетов Dovecot и Telnet, настройке межсетевого экрана, конфигурации Postfix для использования Maildir, восстановлению контекстов SELinux, а также запуску и добавлению служб Postfix и Dovecot в автозагрузку.

   ![Скрипт автоматической настройки почтового сервера](Screenshot_13.png){ #fig:018 width=80% }

10. На виртуальной машине **Client** выполнена корректировка provisioning-скрипта `mail.sh` с добавлением установки почтового клиента Evolution, что обеспечивает автоматическую подготовку клиентского окружения при развёртывании виртуальной машины.

# Вывод

В ходе лабораторной работы был настроен и протестирован почтовый сервер на базе Postfix и Dovecot. Реализована доставка и получение электронной почты с использованием протоколов SMTP, IMAP и POP3, выполнена настройка аутентификации пользователей и хранения почтовых ящиков в формате Maildir. Проверка работы сервера показала корректную доставку сообщений, успешное подключение почтовых клиентов и возможность доступа к почте как через графический интерфейс, так и через терминал. Настройка provisioning-скриптов обеспечила автоматизацию развёртывания и конфигурации почтовой подсистемы.

# Контрольные вопросы

**1. За что отвечает протокол SMTP?**  
Протокол SMTP (Simple Mail Transfer Protocol) предназначен для отправки и пересылки электронных писем. Он используется почтовыми клиентами для передачи исходящих сообщений на почтовый сервер, а также почтовыми серверами для обмена почтой между собой. SMTP не отвечает за хранение писем и их получение пользователями, а обеспечивает только доставку сообщений до сервера-получателя.

**2. За что отвечает протокол IMAP?**  
Протокол IMAP (Internet Message Access Protocol) предназначен для получения и управления электронной почтой, хранящейся на сервере. Он позволяет пользователю просматривать письма, работать с папками, помечать сообщения как прочитанные, удалять или перемещать их, при этом сами письма остаются на сервере. IMAP удобен при работе с почтой с нескольких устройств.

**3. За что отвечает протокол POP3?**  
Протокол POP3 (Post Office Protocol версии 3) используется для получения электронной почты с сервера. Как правило, при использовании POP3 письма загружаются на клиентский компьютер и могут быть удалены с сервера. Протокол ориентирован на простую модель «забрал и прочитал» и не поддерживает расширенное управление папками на сервере.

**4. В чём назначение Dovecot?**  
Dovecot — это сервер получения электронной почты, реализующий протоколы IMAP и POP3. Он отвечает за аутентификацию пользователей, доступ к почтовым ящикам, хранение и выдачу сообщений клиентам. Dovecot обеспечивает безопасный и производительный доступ пользователей к почте.

**5. В каких файлах обычно находятся настройки работы Dovecot? За что отвечает каждый из файлов?**  
Основные настройки Dovecot располагаются в каталоге `/etc/dovecot/`:
- `dovecot.conf` — главный конфигурационный файл, в котором задаются общие параметры работы сервера, включая список поддерживаемых протоколов.
- `conf.d/10-auth.conf` — содержит настройки механизмов аутентификации пользователей.
- `conf.d/auth-system.conf.ext` — определяет источники данных для аутентификации и поиска пользователей (PAM, passwd и другие).
- `conf.d/10-mail.conf` — отвечает за настройку расположения и формата почтовых ящиков пользователей.
- другие файлы в каталоге `conf.d` — используются для более детальной настройки SSL, логирования, лимитов и производительности.

**6. В чём назначение Postfix?**  
Postfix — это почтовый сервер, реализующий протокол SMTP. Он отвечает за приём, маршрутизацию и доставку электронных писем, как локальных, так и отправляемых на другие почтовые серверы. Postfix используется как MTA (Mail Transfer Agent) и часто работает совместно с Dovecot, который обеспечивает получение почты пользователями.

**7. Какие методы аутентификации пользователей можно использовать в Dovecot и в чём их отличие?**  
В Dovecot могут использоваться различные методы аутентификации:
- `plain` — передача логина и пароля в открытом виде, обычно применяется совместно с TLS/SSL.
- `login` — схож с plain, но использует другую последовательность передачи данных.
- `cram-md5` — использует хэширование пароля, повышая уровень безопасности.
- `digest-md5` — обеспечивает защиту от перехвата пароля и повторной отправки данных.
- аутентификация через PAM — использует системные механизмы проверки пользователей.  
Основное отличие методов заключается в уровне безопасности и способе передачи учётных данных.

**8. Приведите пример заголовка письма с пояснениями его полей.**  
Пример заголовка письма:  
From: user@example.net — адрес отправителя.  
To: admin@example.net — адрес получателя.  
Subject: Test message — тема письма.  
Date: Sun, 04 Jan 2026 08:43:15 +0000 — дата и время отправки сообщения.  
Message-ID: уникальный идентификатор письма, используемый для его однозначного определения.  

**9. Приведите примеры использования команд для работы с почтовыми протоколами через терминал.**  
Для проверки работы POP3 можно подключиться к серверу через Telnet на порт 110, выполнить аутентификацию пользователя, получить список писем командой list и просмотреть письмо командой retr.  
Аналогично можно использовать Telnet или OpenSSL для проверки SMTP и IMAP, отправляя команды протоколов напрямую и анализируя ответы сервера.

**10. Приведите примеры с пояснениями по работе с doveadm.**  
Утилита doveadm используется для администрирования Dovecot:
- `doveadm mailbox list -u user` — отображает список почтовых ящиков пользователя.
- `doveadm mailbox status -u user messages INBOX` — показывает количество сообщений в папке INBOX.
- `doveadm auth test user пароль` — проверяет корректность аутентификации пользователя.
- `doveadm quota get -u user` — отображает информацию о квотах почтового ящика.  

Команды doveadm позволяют администратору диагностировать работу почтового сервера, проверять доступ пользователей и состояние их почтовых ящиков.
