---
## Front matter
title: "Отчёт по лабораторной работе 4"
subtitle: "Базовая настройка HTTP-сервера Apache"
author: "Элсаиед Адел"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и базовому конфигурированию HTTP-сервера Apache.

# Выполнение

## Установка и базовое конфигурирование HTTP-сервера (Apache httpd)

1. После загрузки ОС выполнен переход в рабочий каталог проекта Vagrant командой `cd /var/tmp/user_name/vagrant`, после чего произведён запуск виртуальной машины **server** командой `make server-up` (в среде Windows — `vagrant up server`). Далее на виртуальной машине выполнен вход под пользовательской учётной записью и переход в режим суперпользователя.

2. Для установки стандартного HTTP-сервера и сопутствующих утилит выполнен просмотр доступных групп пакетов и установка группы **Basic Web Server**. Команда `dnf -y groupinstall "Basic Web Server"` успешно разрешила зависимости и установила необходимые компоненты веб-сервера (Apache httpd и сопутствующие модули/утилиты).

   ![Установка группы пакетов Basic Web Server](Screenshot_1.png){ #fig:001 width=80% }

3. Выполнен просмотр и анализ конфигурационных файлов HTTP-сервера в каталогах `/etc/httpd/conf` и `/etc/httpd/conf.d`:

   - `/etc/httpd/conf/httpd.conf` — основной конфигурационный файл Apache: задаёт общие параметры (пользователь и группа запуска, корневые каталоги, пути к логам, параметры безопасности), подключение модулей и включение дополнительных конфигураций.
   - `/etc/httpd/conf.modules.d/*.conf` — файлы, отвечающие за загрузку и настройку модулей Apache.
   - `/etc/httpd/conf.d/*.conf` — дополнительные конфигурационные файлы (welcome-страница, виртуальные хосты, параметры SSL, автоиндексация и др.), подключаемые отдельно для удобства сопровождения.
   - Журналы работы веб-сервера по умолчанию размещаются в каталоге `/var/log/httpd/`.

4. Для обеспечения доступа к веб-серверу по протоколу HTTP выполнена настройка межсетевого экрана. В firewalld разрешён сервис `http`, после чего правило сохранено как постоянное. Далее выполнено включение автозапуска службы и запуск HTTP-сервера. Проверка состояния службы с помощью `systemctl status httpd` показала, что сервис успешно запущен и находится в состоянии **active (running)**.

   ![Разрешение сервиса http и запуск службы httpd](Screenshot_2.png){ #fig:002 width=80% }

5. Выполнен запуск виртуальной машины **client** командой `make client-up` (для ОС Windows — `vagrant up client`). На виртуальной машине client открыт веб-браузер и выполнен переход по адресу `192.168.1.1`. В результате отобразилась стандартная тестовая страница **HTTP Server Test Page**, что подтверждает корректную установку и доступность веб-сервера по сети.

   ![Тестовая страница Apache при обращении с client](Screenshot_3.png){ #fig:003 width=80% }

6. Для анализа работы HTTP-сервера на виртуальной машине **server** выполнен мониторинг журналов:
   - просмотр лога ошибок командой `tail -f /var/log/httpd/error_log`;
   - мониторинг лога доступа командой `tail -f /var/log/httpd/access_log`.

   При обращении клиента к веб-серверу в журнале доступа зафиксированы HTTP-запросы браузера (GET `/`, загрузка ресурсов страницы), что подтверждает корректную обработку запросов и регистрацию событий веб-сервером.

   ![Мониторинг error_log и access_log](Screenshot_4.png){ #fig:004 width=80% }

## Настройка виртуального хостинга для HTTP-сервера

1. Для внесения изменений в конфигурацию DNS выполнена остановка службы DNS-сервера командой `systemctl stop named`. Это необходимо для корректного редактирования файлов описания прямой и обратной DNS-зон без риска повреждения журналов транзакций.

2. В файле прямой DNS-зоны `/var/named/master/fz/elsaiedadel.net` добавлена A-запись для виртуального веб-хоста `www`, указывающая на IP-адрес HTTP-сервера `192.168.1.1`. В файле обратной зоны `/var/named/master/rz/192.168.1` добавлена соответствующая PTR-запись для имени `www.elsaiedadel.net`. Перед запуском сервиса удалены журнальные файлы зон (`*.jnl`) для применения изменений.

   ![Файл прямой DNS-зоны elsaiedadel.net](Screenshot_5.png){ #fig:005 width=80% }

   ![Файл обратной DNS-зоны 192.168.1](Screenshot_6.png){ #fig:006 width=80% }

3. После внесения изменений выполнен запуск DNS-сервера командой `systemctl start named`. Служба успешно стартовала и начала обслуживать обновлённые DNS-зоны.

4. В каталоге `/etc/httpd/conf.d` созданы конфигурационные файлы виртуальных хостов `server.elsaiedadel.net.conf` и `www.elsaiedadel.net.conf`. В каждом файле описан виртуальный хост, работающий на порту 80, с указанием администратора сервера, корневого каталога веб-контента, имени хоста и отдельных файлов журналов ошибок и доступа.

   ![Конфигурация виртуального хоста server.elsaiedadel.net](Screenshot_7.png){ #fig:007 width=80% }

   ![Конфигурация виртуального хоста www.elsaiedadel.net](Screenshot_8.png){ #fig:008 width=80% }

5. В каталоге `/var/www/html` созданы подкаталоги `server.elsaiedadel.net` и `www.elsaiedadel.net`, предназначенные для размещения контента соответствующих виртуальных веб-серверов. В каждом каталоге создан файл `index.html` с тестовым содержимым, позволяющим визуально идентифицировать виртуальный хост при обращении через браузер.

   ![Создание каталогов и тестовых страниц виртуальных хостов](Screenshot_9.png){ #fig:009 width=80% }

6. Для корректной работы Apache выполнена настройка прав доступа на каталог с веб-контентом с помощью команды `chown -R apache:apache /var/www`. После этого восстановлены контексты безопасности SELinux для каталогов `/etc`, `/var/named` и `/var/www` командой `restorecon -vR`.

7. После завершения настройки конфигурационных файлов и контента выполнен перезапуск HTTP-сервера командой `systemctl restart httpd`, что обеспечило применение новых параметров виртуального хостинга.

8. На виртуальной машине **client** в веб-браузере выполнена проверка доступности виртуальных хостов по DNS-именам `server.elsaiedadel.net` и `www.elsaiedadel.net`. В обоих случаях корректно отображаются соответствующие тестовые страницы, что подтверждает правильную настройку DNS и виртуального хостинга Apache.

   ![Доступ к server.elsaiedadel.net с client](Screenshot_10.png){ #fig:010 width=80% }

   ![Доступ к www.elsaiedadel.net с client](Screenshot_11.png){ #fig:011 width=80% }

## Внесение изменений в настройки внутреннего окружения виртуальной машины

9. Для автоматизации развёртывания HTTP-сервера выполнена подготовка структуры каталогов provisioning в `/vagrant/provision/server/http`. В соответствующие подкаталоги скопированы конфигурационные файлы Apache и содержимое веб-каталогов, а также обновлённые файлы DNS-сервера.

   ![Копирование конфигурационных файлов в provisioning-каталоги](Screenshot_12.png){ #fig:012 width=80% }

10. В каталоге `/vagrant/provision/server` создан исполняемый скрипт `http.sh`, повторяющий все выполненные ранее действия по установке, настройке и запуску HTTP-сервера. Скрипт устанавливает группу пакетов **Basic Web Server**, копирует конфигурационные файлы, настраивает права доступа, SELinux и межсетевой экран, а также активирует и запускает службу httpd.

   ![Скрипт автоматической настройки HTTP-сервера http.sh](Screenshot_13.png){ #fig:013 width=80% }

11. Для автоматического выполнения скрипта при запуске виртуальной машины в файл `Vagrantfile` добавлена shell-provisioning-секция для сервера с указанием пути к скрипту `provision/server/http.sh`. Это обеспечивает повторяемость конфигурации и автоматическую настройку HTTP-сервера при каждом развёртывании виртуальной машины.

# Вывод

В ходе выполнения лабораторной работы был установлен и настроен HTTP-сервер Apache на базе операционной системы Rocky Linux. Реализовано базовое конфигурирование веб-сервера, настройка межсетевого экрана и анализ работы службы с использованием журналов ошибок и доступа. Дополнительно выполнена настройка виртуального хостинга с использованием DNS-сервера и конфигурационных файлов Apache, что позволило обеспечить доступ к веб-ресурсам по различным доменным именам. Проверка с виртуальной машины client подтвердила корректную работу веб-сервера, правильную обработку HTTP-запросов и функционирование виртуальных хостов. Использование provisioning-скриптов обеспечило автоматизацию и воспроизводимость конфигурации серверного окружения.

# Контрольные вопросы

**1. Через какой порт по умолчанию работает Apache?**  
По умолчанию веб-сервер Apache работает через порт **80** для протокола HTTP. При использовании защищённого соединения HTTPS сервер использует порт **443**, при условии установленной и настроенной поддержки SSL/TLS.

**2. Под каким пользователем запускается Apache и к какой группе относится этот пользователь?**  
В операционных системах семейства RHEL, включая Rocky Linux, Apache запускается от имени пользователя **apache** и относится к группе **apache**. Это обеспечивает изоляцию прав и повышает уровень безопасности веб-сервера.

**3. Где располагаются лог-файлы веб-сервера? Что можно по ним отслеживать?**  
Лог-файлы Apache по умолчанию располагаются в каталоге `/var/log/httpd/`.  
Основные журналы:
- `error_log` — содержит сообщения об ошибках, предупреждениях и служебной информации;
- `access_log` — фиксирует все HTTP-запросы клиентов (IP-адрес, время запроса, URL, код ответа).  
По лог-файлам можно отслеживать работоспособность сервера, ошибки конфигурации, активность пользователей, попытки несанкционированного доступа и статистику обращений.

**4. Где по умолчанию содержится контент веб-серверов?**  
Контент веб-серверов Apache по умолчанию размещается в каталоге `/var/www/html`. Для виртуального хостинга обычно создаются отдельные подкаталоги внутри `/var/www/html`, соответствующие каждому виртуальному хосту.

**5. Каким образом реализуется виртуальный хостинг? Что он даёт?**  
Виртуальный хостинг реализуется с помощью директив `<VirtualHost>` в конфигурационных файлах Apache, размещённых, как правило, в каталоге `/etc/httpd/conf.d`. Каждый виртуальный хост описывает отдельное доменное имя, корневой каталог, файлы логов и параметры обслуживания.  
Виртуальный хостинг позволяет размещать несколько независимых веб-сайтов на одном сервере и одном IP-адресе, обеспечивая логическое разделение ресурсов, удобство администрирования и более эффективное использование серверных мощностей.
