---
## Front matter
title: "Отчёт по лабораторной работе 12"
subtitle: "Синхронизация времени"
author: "Элсаиед Адел"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Получение навыков по управлению системным временем и настройке синхронизации времени.

# Выполнение

## Настройка параметров времени

1. На виртуальных машинах **server** и **client** выполнена проверка параметров настройки даты и времени с использованием утилиты `timedatectl`.  
   В ходе проверки установлено, что обе виртуальные машины работают во временной зоне **UTC (UTC, +0000)**. Системные часы синхронизированы, служба сетевой синхронизации времени активна (`NTP service: active`), аппаратные часы (RTC) не используют локальную временную зону.

2. Для просмотра текущего системного времени на сервере и клиенте была использована команда `date`.  
   Полученные значения подтверждают корректную работу системных часов и соответствие времени данным службы синхронизации.

3. Аппаратное время на сервере и клиенте было проверено с использованием утилиты `hwclock`.  
   Результаты показывают, что аппаратные часы синхронизированы с системным временем, расхождений не обнаружено.

## Управление синхронизацией времени

4. На сервере и клиенте выполнена проверка источников синхронизации времени с помощью утилиты `chronyc sources`.  
   В выводе отображаются используемые NTP-серверы, их адреса, уровень страты (Stratum), параметры опроса и текущее отклонение времени. Активный источник синхронизации отмечен символом `*`.

   ![Источники времени на сервере](Screenshot_1.png)

   ![Источники времени на клиенте](Screenshot_2.png)

5. На сервере открыт для редактирования файл конфигурации `/etc/chrony.conf`.  
   В конфигурацию добавлена директива, разрешающая клиентам из локальной сети использовать сервер в качестве источника времени.

   ![Редактирование chrony.conf на сервере](Screenshot_3.png)

6. После изменения конфигурации выполнен перезапуск службы синхронизации времени `chronyd`, а также произведена настройка межсетевого экрана для разрешения сервиса NTP и применения изменений на постоянной основе.

   ![Настройка межсетевого экрана для NTP](Screenshot_6.png)

7. На клиенте выполнено редактирование файла `/etc/chrony.conf`.  
   В качестве единственного источника синхронизации указан сервер, остальные директивы `server` удалены. Это обеспечивает синхронизацию времени клиента исключительно с локальным сервером.

   ![Редактирование chrony.conf на клиенте](Screenshot_4.png)

8. После перезапуска службы `chronyd` на клиенте повторно проверены источники времени.  
   Результаты подтверждают успешную синхронизацию клиента с сервером.

   ![Проверка источников времени на клиенте](Screenshot_5.png)

9. Дополнительно была просмотрена расширенная информация о состоянии синхронизации времени.  
   Полученные данные подтверждают стабильную работу службы и отсутствие значительных отклонений системных часов.

## Внесение изменений в настройки внутреннего окружения виртуальных машин

10. На виртуальной машине **server** выполнён переход в каталог `/vagrant/provision/server/`.  
    В нём создан каталог `ntp` с подкаталогом `etc`, в который помещён файл конфигурации `chrony.conf`. Также создан исполняемый provisioning-скрипт `ntp.sh`, предназначенный для автоматической установки и настройки службы синхронизации времени при загрузке виртуальной машины.

    ![Подготовка каталогов и файлов на сервере](Screenshot_6.png)

    ![Provisioning-скрипт ntp.sh на сервере](Screenshot_7.png)

11. Аналогичные действия выполнены на виртуальной машине **client**.  
    Создан каталог `/vagrant/provision/client/ntp/etc`, скопирован файл конфигурации `chrony.conf`, а также подготовлен исполняемый provisioning-скрипт `ntp.sh` для применения настроек при старте системы.

    ![Подготовка каталогов и файлов на клиенте](Screenshot_8.png)

    ![Provisioning-скрипт ntp.sh на клиенте](Screenshot_9.png)

В результате выполненных действий обеспечена корректная синхронизация времени между сервером и клиентом, а также реализована автоматизация применения настроек времени при загрузке виртуальных машин с использованием механизмов provisioning Vagrant.

# Вывод

В ходе выполнения лабораторной работы была выполнена настройка параметров времени и синхронизации на виртуальных машинах Server и Client под управлением Linux. Проверены системное и аппаратное время, параметры временной зоны и состояние сетевой синхронизации. С использованием службы chrony реализована централизованная синхронизация времени, при которой сервер выступает в роли локального NTP-узла, а клиент синхронизирует системные часы исключительно с ним. Дополнительно была выполнена настройка межсетевого экрана и автоматизация применения конфигураций с помощью provisioning-скриптов Vagrant. Проведённая проверка подтвердила корректную работу службы синхронизации времени и устойчивость настроенной схемы.

# Контрольные вопросы

**1. Почему важна точная синхронизация времени для служб баз данных?**  
Точная синхронизация времени необходима для корректной работы журналов транзакций, репликации данных, резервного копирования и восстановления. Несогласованность времени между узлами может привести к ошибкам при репликации, некорректному порядку транзакций, проблемам с целостностью данных и затруднениям при анализе журналов событий.

**2. Почему служба проверки подлинности Kerberos сильно зависит от правильной синхронизации времени?**  
Kerberos использует временные метки в билетах аутентификации для защиты от атак повторного воспроизведения. Если разница во времени между клиентом и сервером превышает допустимый порог, билеты считаются недействительными, и аутентификация завершается ошибкой.

**3. Какая служба используется по умолчанию для синхронизации времени на RHEL 7?**  
В RHEL 7 службой синхронизации времени по умолчанию является chrony, которая пришла на смену ntpd и обеспечивает более быструю и устойчивую синхронизацию, в том числе в условиях нестабильного сетевого соединения.

**4. Какова страта по умолчанию для локальных часов?**  
Локальные часы имеют страту 10. Это значение используется для того, чтобы локальный источник времени имел меньший приоритет по сравнению с внешними NTP-серверами.

**5. Какой порт брандмауэра должен быть открыт, если вы настраиваете свой сервер как одноранговый узел NTP?**  
Для работы NTP необходимо открыть порт UDP 123, так как именно через него осуществляется обмен пакетами синхронизации времени.

**6. Какую строку вам нужно включить в конфигурационный файл chrony, если вы хотите быть сервером времени, даже если внешние серверы NTP недоступны?**  
Для этого используется директива `local stratum 10`, которая разрешает серверу использовать локальные часы в качестве источника времени при отсутствии внешней синхронизации.

**7. Какую страту имеет хост, если нет текущей синхронизации времени NTP?**  
Если хост не синхронизирован с внешними источниками NTP и не настроен на использование локальных часов, его страта считается неопределённой, и он не может быть надёжным источником времени для других систем.

**8. Какую команду вы бы использовали на сервере с chrony, чтобы узнать, с какими серверами он синхронизируется?**  
Для этого используется команда `chronyc sources`, которая отображает список источников времени, их состояние, страту и текущие параметры синхронизации.

**9. Как вы можете получить подробную статистику текущих настроек времени для процесса chrony вашего сервера?**  
Подробную информацию можно получить с помощью команды `chronyc tracking`, которая отображает данные о текущем источнике синхронизации, смещении системных часов, частоте коррекции и общем состоянии синхронизации времени.
